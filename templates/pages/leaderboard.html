<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Papan Peringkat - Kebudayaan Banjar</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Fredoka", sans-serif;
        background-color: #f7f1e5;
        margin: 0;
        padding: 20px;
        display: flex;
        justify-content: center;
      }

      .leaderboard-container {
        width: 100%;
        max-width: 800px;
        background: white;
        border: 5px solid #000;
        border-radius: 30px;
        box-shadow: 15px 15px 0px #deba03;
        overflow: hidden;
        animation: slideUp 0.5s ease-out;
      }

      @keyframes slideUp {
        from {
          transform: translateY(50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      /* Header */
      .header {
        background-color: #deba03;
        padding: 30px;
        text-align: center;
        border-bottom: 5px solid #000;
        position: relative;
      }

      .header h1 {
        margin: 0;
        font-size: 32px;
        color: white;
        text-shadow: 3px 3px 0px #000;
        letter-spacing: 2px;
      }

      .btn-back {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        text-decoration: none;
        background: #fa8e7d;
        border: 3px solid #000;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: 0.2s;
      }

      .btn-back:hover {
        transform: translateY(-50%) scale(1.1);
        background: #ff7675;
      }

      /* Podium (Top 3) */
      .podium {
        display: flex;
        justify-content: center;
        align-items: flex-end;
        padding: 40px 20px;
        background: #fffdf0;
        gap: 15px;
        border-bottom: 3px solid #eee;
      }

      .podium-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
      }

      .rank-box {
        border: 4px solid #000;
        border-radius: 20px 20px 0 0;
        width: 110px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        padding: 10px;
        font-weight: bold;
      }

      .gold {
        background: #ffd700;
        height: 160px;
      }
      .silver {
        background: #dfe6e9;
        height: 130px;
      }
      .bronze {
        background: #cd7f32;
        height: 100px;
        color: white;
      }

      .avatar {
        width: 65px;
        height: 65px;
        border-radius: 50%;
        border: 3px solid #000;
        background: white;
        margin-bottom: 10px;
        object-fit: cover;
      }

      .username-top {
        font-size: 14px;
        font-weight: bold;
        margin-bottom: 5px;
        max-width: 100px;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
      }

      /* List Section */
      .rank-list {
        padding: 20px;
        background: white;
      }

      .rank-row {
        display: flex;
        align-items: center;
        padding: 15px 20px;
        margin-bottom: 12px;
        background: #fff;
        border: 3px solid #000;
        border-radius: 20px;
        transition: 0.2s;
      }

      .rank-row:hover {
        transform: translateX(10px);
        box-shadow: 5px 5px 0px #000;
      }

      .rank-number {
        font-size: 22px;
        font-weight: bold;
        width: 50px;
        color: #7f8c8d;
      }

      .user-info {
        flex-grow: 1;
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .user-info img {
        width: 45px;
        height: 45px;
        border: 2px solid #000;
        border-radius: 50%;
      }

      .score-pill {
        background: #9b59b6;
        color: white;
        padding: 8px 18px;
        border-radius: 15px;
        border: 2px solid #000;
        font-weight: bold;
        font-size: 14px;
      }

      /* Highlight Row Siswa Sendiri */
      .rank-row.me {
        background: #fff9db;
        border-color: #deba03;
      }

      @media (max-width: 600px) {
        .podium {
          transform: scale(0.85);
          gap: 5px;
        }
        .header h1 {
          font-size: 24px;
        }
      }
    </style>
  </head>
  <body>
    <div class="leaderboard-container">
      <div class="header">
        <a href="{{ url_for('home') }}" class="btn-back">
          <img
            src="/static/Image/x.png"
            width="20"
            style="filter: brightness(0) invert(1)"
            alt="X"
          />
        </a>
        <h1>üèÜ PAPAN PERINGKAT</h1>
      </div>

      <div class="podium">
        <div class="podium-item">
          <div class="username-top" id="name-2">---</div>
          <img src="/static/Image/user.png" class="avatar" alt="User" />
          <div class="rank-box silver">
            <span>ü•à #2</span>
            <small id="score-2">0 Pts</small>
          </div>
        </div>

        <div class="podium-item">
          <div
            class="username-top"
            style="font-size: 16px; color: #d4af37"
            id="name-1"
          >
            ---
          </div>
          <img
            src="/static/Image/user.png"
            class="avatar"
            style="width: 85px; height: 85px; border-width: 4px"
            alt="User"
          />
          <div class="rank-box gold">
            <span>üëë JUARA 1</span>
            <small id="score-1">0 Pts</small>
          </div>
        </div>

        <div class="podium-item">
          <div class="username-top" id="name-3">---</div>
          <img src="/static/Image/user.png" class="avatar" alt="User" />
          <div class="rank-box bronze">
            <span>ü•â #3</span>
            <small id="score-3">0 Pts</small>
          </div>
        </div>
      </div>

      <div class="rank-list" id="rank-list">
        <p style="text-align: center; color: #95a5a6">Memuat data jawara...</p>
      </div>
    </div>

    <script>
      async function fetchLeaderboard() {
        try {
          const response = await fetch("/api/leaderboard_data");
          const data = await response.json();

          const listEl = document.getElementById("rank-list");
          listEl.innerHTML = "";

          if (data.length === 0) {
            listEl.innerHTML =
              '<p style="text-align:center;">Belum ada data peringkat. Ayo mainkan gamenya!</p>';
            return;
          }

          // Update Podium Top 3
          if (data[0]) {
            document.getElementById("name-1").innerText = data[0].username;
            document.getElementById("score-1").innerText =
              data[0].total_score + " Pts";
          }
          if (data[1]) {
            document.getElementById("name-2").innerText = data[1].username;
            document.getElementById("score-2").innerText =
              data[1].total_score + " Pts";
          }
          if (data[2]) {
            document.getElementById("name-3").innerText = data[2].username;
            document.getElementById("score-3").innerText =
              data[2].total_score + " Pts";
          }

          // List Lengkap
          data.forEach((user, index) => {
            const isMe = user.email === "{{ session['user'] }}";
            const row = `
                    <div class="rank-row ${isMe ? "me" : ""}">
                        <div class="rank-number">${index + 1}</div>
                        <div class="user-info">
                            <img src="/static/Image/user.png" alt="User">
                            <span><strong>${user.username}</strong> ${
              isMe ? "<small>(Kamu)</small>" : ""
            }</span>
                        </div>
                        <div class="score-pill">${user.total_score} Pts</div>
                    </div>
                `;
            listEl.innerHTML += row;
          });
        } catch (error) {
          console.error("Error:", error);
          document.getElementById("rank-list").innerHTML = "Gagal memuat data.";
        }
      }

      fetchLeaderboard();
    </script>
  </body>
</html>
