<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stage Matching</title>

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Fredoka", sans-serif;
        background-color: #f7f1e5;
        margin: 0;
        overflow-x: hidden;
        overflow-y: auto;
      }

      /* Area scroll stage */
      .container-scroll {
        position: relative;
        margin: 220px auto 0 auto;
        width: 85%;
        height: 500px;
        overflow-x: auto;
        display: flex;
        gap: 40px;
        align-items: center;
        justify-content: flex-start;
        padding: 20px;
        scroll-behavior: smooth;
        scrollbar-width: none;
      }

      .container-scroll::-webkit-scrollbar {
        display: none;
      }

      /* Kotak stage */
      .kotak_materi_panjang {
        position: relative;
        width: 250px;
        height: 400px;
        border-radius: 40px;
        text-align: center;
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        flex: 0 0 auto;
        cursor: pointer;
        transition: transform 0.3s;
        overflow: hidden;
      }

      .kotak_materi_panjang.locked {
        filter: grayscale(100%);
        cursor: not-allowed;
      }

      .kotak_materi_panjang:hover:not(.locked) {
        transform: scale(1.05);
      }

      .kotak_materi_panjang img {
        margin-top: 50px;
        width: 260px;
        position: relative;
        z-index: 1;
        transition: opacity 0.3s;
        filter: drop-shadow(0px 6px 10px rgba(0, 0, 0, 0.25));
      }

      .tulisan_rumah_adat {
        font-size: 35px;
        margin-top: 25px;
        color: #333;
      }

      /* ============================
         RESPONSIVE UNTUK HP
      ============================ */
      @media (max-width: 768px) {
        body {
          text-align: center;
          overflow-x: hidden;
        }

        /* Tombol Back */
        .back {
          position: absolute !important;
          width: 48px;
          height: 48px;
          top: 12px;
          left: 12px;
          margin: 0 !important;
          z-index: 12000;
        }

        .gambar_back {
          width: 28px;
          height: 28px;
          top: 10px;
          left: 10px;
        }

        /* Judul */
        .kotak_materi_diatas {
          position: absolute !important;
          top: 14px !important;
          left: 50%;
          transform: translateX(-50%);
          width: 200px;
          height: 42px;
          border-width: 3px;
          border-radius: 40px;
          margin: 0 !important;
          z-index: 9000;
        }

        .tulisan_materi_diatas {
          font-size: 18px !important;
          position: fixed !important;
          top: 10px !important;
          left: 50% !important;
          transform: translateX(-50%);
          white-space: nowrap !important;
        }

        /* Container jadi vertikal */
        .container-scroll {
          flex-direction: column !important;
          width: 100% !important;
          height: auto !important;
          overflow-x: hidden !important;
          overflow-y: auto !important;
          align-items: center !important;
          justify-content: flex-start !important;
          margin-top: 120px !important;
          gap: 30px !important;
          padding-bottom: 100px !important;
        }

        /* Kotak stage di HP */
        .kotak_materi_panjang {
          width: 260px !important;
          height: 350px !important;
          margin: 0 auto !important;
        }

        .kotak_materi_panjang img {
          height: 190px !important;
          margin-top: 45px !important;
          width: auto;
        }

        .tulisan_rumah_adat {
          font-size: 26px !important;
          margin-top: 15px !important;
          text-align: center !important;
        }

        .ornamen-banjar {
          width: 180px !important;
          right: -30px !important;
          bottom: -50px !important;
        }

        a {
          text-decoration: none;
        }
      }
    </style>
  </head>

  <body>
    <a href="{{ url_for('game') }}">
      <div class="back">
        <img src="/static/Image/back.png" alt="kembali" class="gambar_back" />
      </div>
    </a>

    <div class="kotak_materi_diatas" style="top: 5px">
      <div class="tulisan_materi_diatas" style="left: 93px">Stage Matching</div>
    </div>

    <div class="container-scroll" id="stageContainer"></div>

    <img src="/static/Image/ornamen.png" class="ornamen-banjar" />
    <img
      src="/static/Image/ornamen_2.png"
      class="ornamen-banjar"
      style="left: -200px; bottom: -130px; width: 700px"
    />

    <script>
      const stages = [
        {
          id: 1,
          color: "#deba03",
          mainImage: "/static/Image/matching_1.png",
          lockImage: "/static/Image/lock.png",
          url: "{{ url_for('matching_1') }}",
        },
        {
          id: 2,
          color: "#fa8e7d",
          mainImage: "/static/Image/matching_2.png",
          lockImage: "/static/Image/lock.png",
          url: "{{ url_for('matching_2') }}",
        },
        {
          id: 3,
          color: "#71b871",
          mainImage: "/static/Image/matching_3.png",
          lockImage: "/static/Image/lock.png",
          url: "{{ url_for('matching_3') }}",
        },
        {
          id: 4,
          color: "#deba03",
          mainImage: "/static/Image/matching_4.png",
          lockImage: "/static/Image/lock.png",
          url: "{{ url_for('matching_4') }}",
        },
        {
          id: 5,
          color: "#fa8e7d",
          mainImage: "/static/Image/matching_5.png",
          lockImage: "/static/Image/lock.png",
          url: "{{ url_for('matching_5') }}",
        },
        {
          id: 6,
          color: "#71b871",
          mainImage: "/static/Image/matching_6.png",
          lockImage: "/static/Image/lock.png",
          url: "{{ url_for('matching_6') }}",
        },
        {
          id: 7,
          color: "#deba03",
          mainImage: "/static/Image/matching_7.png",
          lockImage: "/static/Image/lock.png",
          url: "{{ url_for('matching_7') }}",
        },
        {
          id: 8,
          color: "#fa8e7d",
          mainImage: "/static/Image/matching_8.png",
          lockImage: "/static/Image/lock.png",
          url: "{{ url_for('matching_8') }}",
        },
        {
          id: 9,
          color: "#71b871",
          mainImage: "/static/Image/matching_9.png",
          lockImage: "/static/Image/lock.png",
          url: "{{ url_for('matching_9') }}",
        },
        {
          id: 10,
          color: "#deba03",
          mainImage: "/static/Image/matching_10.png",
          lockImage: "/static/Image/lock.png",
          url: "{{ url_for('matching_10') }}",
        },
      ];

      // ==========================
      // SISTEM PROGRESS MATCHING (DATABASE)
      // ==========================
      // Variabel max_stage dikirim dari Flask App.py
      const maxStage = Number("{{ max_stage }}");

      const container = document.getElementById("stageContainer");

      stages.forEach((stage) => {
        const div = document.createElement("div");
        div.classList.add("kotak_materi_panjang");
        div.style.backgroundColor = stage.color;

        const img = document.createElement("img");

        // Logika Kunci: Jika ID Stage > maxStage, maka terkunci
        if (stage.id > maxStage) {
          div.classList.add("locked");
          img.src = stage.lockImage; // Gambar Gembok
        } else {
          img.src = stage.mainImage; // Gambar Asli
        }

        div.appendChild(img);

        const p = document.createElement("p");
        p.classList.add("tulisan_rumah_adat");
        p.textContent = "Stage " + stage.id;
        div.appendChild(p);

        div.addEventListener("click", () => {
          if (stage.id > maxStage) {
            alert("ðŸ”’ Selesaikan stage sebelumnya dulu!");
          } else {
            window.location.href = stage.url;
          }
        });

        container.appendChild(div);
      });
    </script>
  </body>
</html>
