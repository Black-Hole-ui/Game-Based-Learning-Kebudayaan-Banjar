<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stage 8 - Quiz</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/quiz.css') }}"
    />
    <style>
      /* ===============================
        ğŸŒŸ RESPONSIVE MOBILE FIX
      ================================ */
      @media (max-width: 768px) {
        body {
          text-align: center;
          overflow-x: hidden;
        }
        /* Tombol Back */
        .back {
          position: absolute !important;
          width: 48px;
          height: 48px;
          top: 12px;
          left: 12px;
          margin: 0 !important;
          z-index: 12000;
        }
        .gambar_back {
          width: 28px;
          height: 28px;
          top: 10px;
          left: 10px;
        }
        /* Judul atas */
        .kotak_materi_diatas {
          width: 50%;
          height: 60px;
          margin-top: 20px;
          border-radius: 40px;
          font-size: 18px;
        }
        .tulisan_materi_diatas {
          font-size: 22px;
        }
        /* Cerita container */
        .container-cerita {
          width: 90%;
          height: auto;
          min-height: 400px;
          top: 130px;
          padding: 25px 20px;
        }
        .cerita {
          font-size: 20px !important;
          line-height: 1.6;
          text-align: justify;
        }
        /* Huruf pertama besar */
        .cerita::first-letter {
          font-size: 37.5px;
          font-weight: 700;
          color: #f5a623;
          float: left;
          margin-right: 6px;
          margin-top: -20px;
          margin-bottom: -10px;
        }
        #soal_lanjut {
          position: relative;
          margin-top: 25px;
          font-size: 20px !important;
          width: 80%;
        }
        /* Quiz container */
        .quiz-container {
          width: 90%;
          padding: 25px;
          top: 150px;
        }
        .question {
          font-size: 20px;
        }
        .options button {
          width: 100%;
          font-size: 18px;
          padding: 12px;
        }
        .next-btn {
          width: 60%;
          font-size: 18px;
          padding: 10px;
        }
        .result {
          font-size: 18px;
        }
        .result-box {
          font-size: 18px;
          padding: 15px;
        }
        .materi-btn {
          font-size: 18px;
          padding: 10px 20px;
        }
      }
    </style>
  </head>

  <body>
    <a href="{{ url_for('quiz') }}">
      <div class="back">
        <img
          src="/static/Image/back.png"
          alt="gambar kembali"
          class="gambar_back"
        />
      </div>
    </a>

    <div class="kotak_materi_diatas">
      <div class="tulisan_materi_diatas">Stage 8 - Quiz</div>
    </div>

    <div class="quiz-container" style="display: none">
      <div id="quiz">
        <div class="question" id="question"></div>
        <div class="options" id="options"></div>
        <button class="next-btn" id="nextBtn">Next</button>
      </div>
      <div class="result" id="result"></div>
    </div>

    <div class="container-cerita">
      <div class="cerita-scroll">
        <p class="cerita">
          Nenek membimbingmu ke Balai Bini, bangunan panjang yang khas di
          halaman rumah Banjar. â€œIni Balai Bini, Nak,â€ ujarnya. â€œDahulu, ruangan
          ini khusus untuk perempuan, tempat berkumpul, belajar, dan melakukan
          kegiatan adat.â€ğŸŒº<br /><br />
          Kamu melihat susunan kayu yang rapi, dengan ukiran geometris dan motif
          kembang bogam di dinding. Nenek menjelaskan, â€œBalai Bini bukan sekadar
          tempat duduk atau bekerja, tapi juga simbol keteraturan, keharmonisan,
          dan peran penting perempuan dalam budaya Banjar.â€<br /><br />
          Di tengah balai, terdapat meja panjang berisi kue-kue tradisional.
          Nenek tersenyum sambil mengambil Putu Mayang yang tersusun rapi. â€œNah,
          Nak, ini Putu Mayang. Kue ini sering dibawa ke Balai Bini saat acara
          tertentu. Bentuknya menyerupai lunjuran mayang yang berurai,
          menandakan kebersamaan dan ikatan emosional di komunitas perempuan
          Banjar.â€ ğŸŒ¸<br /><br />
          Ia memperagakan cara menyajikannya, â€œPutu Mayang biasanya disajikan
          dengan kuah santan gula merah. Teksturnya lembut, warnanya cerah, dan
          rasanya manis, cocok untuk disantap saat berkumpul atau belajar di
          Balai Bini.â€ ğŸ˜‹<br /><br />
          Kamu menatap sekeliling dan berpikir, â€œTernyata Balai Bini dan Putu
          Mayang saling berkaitan, Nek. Bangunan dan makanan sama-sama
          mengajarkan nilai kebersamaan dan budaya.â€<br /><br />
          Nenek tersenyum hangat. â€œBetul, Nak. Setiap bagian rumah dan setiap
          kue punya filosofi. Menghargai semuanya berarti menghargai budaya
          Banjar itu sendiri.â€ âœ¨
        </p>
      </div>
      <button id="soal_lanjut" onclick="soal_lanjut()">Lanjut</button>
    </div>

    <script>
      // ==============================
      // DATA PERTANYAAN QUIZ
      // ==============================
      const quizData = [
        {
          question: "Apa fungsi utama Balai Bini pada zaman dahulu?",
          options: [
            "Tempat perempuan berkumpul untuk kegiatan adat harian dan musyawarah keluarga",
            "Tempat penyimpanan senjata, peralatan perang, dan barang-barang berharga lainnya",
            "Ruang makan dan ruang santai untuk seluruh anggota keluarga dan tamu yang hadir",
            "Kamar tidur utama bagi kepala keluarga atau bangsawan yang menempati rumah",
          ],
          answer:
            "Tempat perempuan berkumpul untuk kegiatan adat harian dan musyawarah keluarga",
        },
        {
          question: "Apa makna simbolik Balai Bini bagi masyarakat Banjar?",
          options: [
            "Menunjukkan kekayaan keluarga, status sosial bangsawan, dan kemegahan rumah adat",
            "Melambangkan keteraturan, keharmonisan, dan peran penting perempuan dalam budaya",
            "Hanya sebagai tempat untuk beristirahat, tidur, dan melakukan kegiatan pribadi sehari-hari",
            "Menyimbolkan keberanian, kekuatan fisik laki-laki, dan dominasi keluarga di masyarakat",
          ],
          answer:
            "Melambangkan keteraturan, keharmonisan, dan peran penting perempuan dalam budaya",
        },
        {
          question: "Mengapa Putu Mayang sering disajikan di Balai Bini?",
          options: [
            "Karena melambangkan kebersamaan, ikatan emosional, dan peran perempuan dalam komunitas",
            "Karena mudah dibuat, bisa disimpan lama, dan rasanya cocok untuk pesta keluarga besar",
            "Karena disukai semua anggota keluarga, termasuk anak-anak, pria, dan tamu istimewa",
            "Karena bentuknya menyerupai rumah adat, simbol sejarah dan cerita leluhur Banjar",
          ],
          answer:
            "Karena melambangkan kebersamaan, ikatan emosional, dan peran perempuan dalam komunitas",
        },
        {
          question: "Bahan utama Putu Mayang adalah â€¦",
          options: [
            "Tepung terigu, telur ayam, margarin, gula pasir, dan air bersih matang",
            "Tepung ketan, kelapa parut, santan kental, gula merah, dan garam halus",
            "Tepung beras, tepung tapioka, santan, gula pasir, dan sedikit garam halus",
            "Tepung singkong, gula aren, santan cair, susu segar, dan garam secukupnya",
          ],
          answer:
            "Tepung beras, tepung tapioka, santan, gula pasir, dan sedikit garam halus",
        },
        {
          question: "Apa tujuan diberi warna merah dan hijau pada Putu Mayang?",
          options: [
            "Untuk menandai waktu pembuatan kue serta mempermudah identifikasi jenis adonan",
            "Agar bisa dibedakan antara kue rasa manis dengan rasa gurih dan asin",
            "Untuk menunjukkan perbedaan jenis tepung yang digunakan dalam pembuatan kue",
            "Untuk membuat tampilan kue lebih menarik dan simbol keragaman budaya masyarakat",
          ],
          answer:
            "Untuk membuat tampilan kue lebih menarik dan simbol keragaman budaya masyarakat",
        },
        {
          question: "Dengan apa Putu Mayang biasanya disajikan?",
          options: [
            "Sirup cokelat manis, taburan kacang, dan parutan keju lembut di atasnya",
            "Selai kacang, susu kental manis, dan potongan buah segar sebagai topping",
            "Gula pasir kering, air hangat, dan sedikit garam untuk rasa seimbang pada kue",
            "Kuah santan gula merah yang lembut, manis, gurih, dan hangat sebagai pelengkap kue",
          ],
          answer:
            "Kuah santan gula merah yang lembut, manis, gurih, dan hangat sebagai pelengkap kue",
        },
        {
          question:
            "Apa filosofi bentuk Putu Mayang yang menyerupai lunjuran mayang?",
          options: [
            "Menunjukkan kemampuan memasak masyarakat Banjar dan keahlian dalam seni kue",
            "Hanya untuk mempermudah penyusunan kue di piring dan tampilan saat disajikan",
            "Melambangkan kebersamaan, keterikatan sosial, dan hubungan antaranggota masyarakat",
            "Melambangkan jalur sungai, arah mata angin, dan hubungan manusia dengan alam",
          ],
          answer:
            "Melambangkan kebersamaan, keterikatan sosial, dan hubungan antaranggota masyarakat",
        },
        {
          question:
            "Bagaimana hubungan Balai Bini dan Putu Mayang secara budaya?",
          options: [
            "Keduanya mengajarkan nilai kebersamaan, peran perempuan, dan tradisi adat Banjar",
            "Balai Bini hanya sebagai ruang istirahat, Putu Mayang hanya sebagai kue anak-anak",
            "Balai Bini simbol laki-laki, Putu Mayang simbol perempuan, tanpa makna lebih lanjut",
            "Tidak ada hubungan, keduanya hanya ditempatkan berdekatan di rumah adat Banjar",
          ],
          answer:
            "Keduanya mengajarkan nilai kebersamaan, peran perempuan, dan tradisi adat Banjar",
        },
      ];

      let currentQuestion = 0;
      let score = 0;
      let startTime; // Variabel waktu mulai

      const questionEl = document.getElementById("question");
      const optionsEl = document.getElementById("options");
      const nextBtn = document.getElementById("nextBtn");
      const resultEl = document.getElementById("result");

      function loadQuestion() {
        const current = quizData[currentQuestion];
        questionEl.textContent = current.question;
        optionsEl.innerHTML = "";
        nextBtn.style.display = "none";
        current.options.forEach((opt) => {
          const btn = document.createElement("button");
          btn.textContent = opt;
          btn.onclick = () => checkAnswer(btn, opt);
          optionsEl.appendChild(btn);
        });
      }

      function checkAnswer(btn, selected) {
        const correct = quizData[currentQuestion].answer;
        const buttons = optionsEl.querySelectorAll("button");
        buttons.forEach((b) => (b.disabled = true));
        if (selected === correct) {
          btn.classList.add("correct");
          score++;
        } else {
          btn.classList.add("wrong");
          buttons.forEach((b) => {
            if (b.textContent === correct) b.classList.add("correct");
          });
        }
        nextBtn.style.display = "inline-block";
      }

      nextBtn.addEventListener("click", () => {
        currentQuestion++;
        if (currentQuestion < quizData.length) {
          loadQuestion();
        } else {
          finishQuiz();
        }
      });

      function finishQuiz() {
        document.getElementById("quiz").style.display = "none";

        // 1. Hitung durasi waktu pengerjaan
        const endTime = new Date();
        const durasiDetik = Math.floor((endTime - startTime) / 1000);

        const minCorrect = Math.ceil(quizData.length / 2);

        // 2. Kirim ke database (Stage 8)
        fetch("/api/submit_quiz", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            game_name: "quiz",
            stage: 8,
            score: score,
            total_soal: quizData.length,
            time_taken: durasiDetik,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            resultEl.innerHTML = `<strong>Kamu menjawab ${score}/${quizData.length} dengan benar!</strong><br>
                                  <small>Waktu pengerjaan: ${durasiDetik} detik</small><br><br>`;

            if (data.passed) {
              resultEl.innerHTML += `
                <div class="result-box success">
                    ğŸ‰ Selamat! Kamu berhasil menjawab minimal ${minCorrect} soal dengan benar.<br>
                    Stage berikutnya telah terbuka!
                </div>`;
              setTimeout(() => {
                window.location.href = "{{ url_for('quiz') }}";
              }, 3500);
            } else {
              resultEl.innerHTML += `
                <div class="result-box fail">
                    ğŸ˜¢ Kamu hanya menjawab ${score} dari ${quizData.length} dengan benar.<br>
                    <p>Pelajari kembali materinya sebelum mencoba lagi.</p>
                    <a href="{{ url_for('materi') }}" class="materi-btn">ğŸ“– Lihat Materi</a>
                </div>`;
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            alert("Terjadi kesalahan saat menyimpan nilai.");
          });
      }

      function shuffleQuestions(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
      }

      function soal_lanjut() {
        document.querySelector(".container-cerita").style.display = "none";
        document.querySelector(".quiz-container").style.display = "block";
        startTime = new Date(); // Mulai hitung waktu tepat saat quiz muncul
      }

      // Inisialisasi awal
      shuffleQuestions(quizData);
      loadQuestion();
    </script>
  </body>
</html>
